<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Roberto Cantillan">
<meta name="dcterms.date" content="2025-06-15">

<title>Análisis de Clases Latentes y Patrones de Movilidad</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="02_reporte_completo_files/libs/clipboard/clipboard.min.js"></script>
<script src="02_reporte_completo_files/libs/quarto-html/quarto.js"></script>
<script src="02_reporte_completo_files/libs/quarto-html/popper.min.js"></script>
<script src="02_reporte_completo_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02_reporte_completo_files/libs/quarto-html/anchor.min.js"></script>
<link href="02_reporte_completo_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02_reporte_completo_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02_reporte_completo_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02_reporte_completo_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02_reporte_completo_files/libs/bootstrap/bootstrap-2307b71a298ed1cfb9f74c0c6b4d35d8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: rgba(0, 0, 0, 0.8);
      }

      .quarto-title-block .quarto-title-banner {
        color: rgba(0, 0, 0, 0.8);
background: featured.jpg;
      }
</style>
<script src="02_reporte_completo_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="02_reporte_completo_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



<link rel="stylesheet" href="custom.scss">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Análisis de Clases Latentes y Patrones de Movilidad</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Latent Class Analysis</div>
                <div class="quarto-category">Multinomial regression</div>
                <div class="quarto-category">Sustenaible Mobility</div>
                <div class="quarto-category">Sustenaible Development</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Roberto Cantillan </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Departamento de Sociología
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 15, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      <p>Este documento presenta un análisis sociológico que identifica perfiles ambientales mediante modelos de clases latentes (LCA) y examina su relación con patrones de movilidad en la región del Maule, Chile. Utilizando datos de encuestas sobre actitudes ambientales, se identifican tres clases latentes: Ambientalismo Moderado (60%), Modo de Vida Imperial (13%) y Ambientalismo Crítico (27%). Mediante modelos multinomiales, se analiza cómo estas clases predicen elecciones de transporte actual y preferencias futuras, controlando por factores sociodemográficos. Los resultados revelan asociaciones selectivas entre perfiles ambientales y movilidad, destacando que los factores estructurales ejercen mayor influencia que las actitudes en los comportamientos de movilidad cotidiana.</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">En este documento</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción">Introducción</a></li>
  <li><a href="#configuración-inicial" id="toc-configuración-inicial" class="nav-link" data-scroll-target="#configuración-inicial">Configuración inicial</a></li>
  <li><a href="#carga-y-preparación-de-datos" id="toc-carga-y-preparación-de-datos" class="nav-link" data-scroll-target="#carga-y-preparación-de-datos">Carga y Preparación de Datos</a>
  <ul class="collapse">
  <li><a href="#carga-de-datos-base" id="toc-carga-de-datos-base" class="nav-link" data-scroll-target="#carga-de-datos-base">Carga de datos base</a></li>
  <li><a href="#creación-del-indicador-de-clase-social" id="toc-creación-del-indicador-de-clase-social" class="nav-link" data-scroll-target="#creación-del-indicador-de-clase-social">Creación del Indicador de Clase Social</a></li>
  </ul></li>
  <li><a href="#análisis-de-clases-latentes-lca" id="toc-análisis-de-clases-latentes-lca" class="nav-link" data-scroll-target="#análisis-de-clases-latentes-lca">Análisis de Clases Latentes (LCA)</a>
  <ul class="collapse">
  <li><a href="#preparación-de-variables-para-el-modelo-lca" id="toc-preparación-de-variables-para-el-modelo-lca" class="nav-link" data-scroll-target="#preparación-de-variables-para-el-modelo-lca">Preparación de variables para el modelo LCA</a></li>
  <li><a href="#ajuste-de-modelos-de-clases-latentes" id="toc-ajuste-de-modelos-de-clases-latentes" class="nav-link" data-scroll-target="#ajuste-de-modelos-de-clases-latentes">Ajuste de modelos de clases latentes</a></li>
  <li><a href="#comparación-de-modelos" id="toc-comparación-de-modelos" class="nav-link" data-scroll-target="#comparación-de-modelos">Comparación de modelos</a></li>
  <li><a href="#interpretación-del-modelo-de-3-clases" id="toc-interpretación-del-modelo-de-3-clases" class="nav-link" data-scroll-target="#interpretación-del-modelo-de-3-clases">Interpretación del modelo de 3 clases</a>
  <ul class="collapse">
  <li><a href="#descripción-de-las-clases-latentes" id="toc-descripción-de-las-clases-latentes" class="nav-link" data-scroll-target="#descripción-de-las-clases-latentes">Descripción de las clases latentes</a></li>
  </ul></li>
  <li><a href="#asignación-de-clases-a-individuos" id="toc-asignación-de-clases-a-individuos" class="nav-link" data-scroll-target="#asignación-de-clases-a-individuos">Asignación de clases a individuos</a></li>
  <li><a href="#efecto-de-las-covariables-en-la-pertenencia-a-clases" id="toc-efecto-de-las-covariables-en-la-pertenencia-a-clases" class="nav-link" data-scroll-target="#efecto-de-las-covariables-en-la-pertenencia-a-clases">Efecto de las covariables en la pertenencia a clases</a></li>
  </ul></li>
  <li><a href="#análisis-de-patrones-de-movilidad" id="toc-análisis-de-patrones-de-movilidad" class="nav-link" data-scroll-target="#análisis-de-patrones-de-movilidad">Análisis de Patrones de Movilidad</a>
  <ul class="collapse">
  <li><a href="#recodificación-de-variables-de-movilidad" id="toc-recodificación-de-variables-de-movilidad" class="nav-link" data-scroll-target="#recodificación-de-variables-de-movilidad">Recodificación de variables de movilidad</a></li>
  <li><a href="#análisis-bivariado-clases-latentes-y-movilidad-presente" id="toc-análisis-bivariado-clases-latentes-y-movilidad-presente" class="nav-link" data-scroll-target="#análisis-bivariado-clases-latentes-y-movilidad-presente">Análisis bivariado: Clases latentes y movilidad presente</a></li>
  <li><a href="#análisis-bivariado-clases-latentes-y-movilidad-futura" id="toc-análisis-bivariado-clases-latentes-y-movilidad-futura" class="nav-link" data-scroll-target="#análisis-bivariado-clases-latentes-y-movilidad-futura">Análisis bivariado: Clases latentes y movilidad futura</a></li>
  </ul></li>
  <li><a href="#modelos-multinomiales" id="toc-modelos-multinomiales" class="nav-link" data-scroll-target="#modelos-multinomiales">Modelos Multinomiales</a>
  <ul class="collapse">
  <li><a href="#preparación-de-datos-para-los-modelos" id="toc-preparación-de-datos-para-los-modelos" class="nav-link" data-scroll-target="#preparación-de-datos-para-los-modelos">Preparación de datos para los modelos</a></li>
  <li><a href="#modelo-para-movilidad-presente" id="toc-modelo-para-movilidad-presente" class="nav-link" data-scroll-target="#modelo-para-movilidad-presente">Modelo para movilidad presente</a></li>
  <li><a href="#modelo-para-movilidad-futura" id="toc-modelo-para-movilidad-futura" class="nav-link" data-scroll-target="#modelo-para-movilidad-futura">Modelo para movilidad futura</a></li>
  </ul></li>
  <li><a href="#discusión-y-conclusiones" id="toc-discusión-y-conclusiones" class="nav-link" data-scroll-target="#discusión-y-conclusiones">Discusión y Conclusiones</a></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introducción" class="level1">
<h1>Introducción</h1>
<p>Este documento presenta un análisis sociológico de clases latentes para identificar perfiles ambientales y su relación con patrones de movilidad. El análisis tiene dos componentes principales:</p>
<ol type="1">
<li><strong>Análisis de Clases Latentes</strong>: Identificamos grupos latentes basados en actitudes ambientales</li>
<li><strong>Modelo Multinomial</strong>: Analizamos la relación entre las clases latentes identificadas y los patrones de movilidad</li>
</ol>
<p>El estudio utiliza datos de la región del Maule (Chile) e integra variables sociodemográficas y actitudes medioambientales.</p>
</section>
<section id="configuración-inicial" class="level1">
<h1>Configuración inicial</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar paquetes necesarios</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)    <span class="co"># Para manipulación y visualización de datos</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(poLCA)        <span class="co"># Para análisis de clases latentes</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)        <span class="co"># Para presentación de tablas</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)   <span class="co"># Para mejorar el formato de tablas</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)      <span class="co"># Para visualizaciones avanzadas</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)    <span class="co"># Para combinar gráficos</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)         <span class="co"># Para rutas de archivos relativas al proyecto</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)        <span class="co"># Para leer archivos SPSS (.sav)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)         <span class="co"># Para modelos multinomiales</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)      <span class="co"># Para visualizar efectos</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)       <span class="co"># Para formato en gráficos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="carga-y-preparación-de-datos" class="level1">
<h1>Carga y Preparación de Datos</h1>
<section id="carga-de-datos-base" class="level2">
<h2 class="anchored" data-anchor-id="carga-de-datos-base">Carga de datos base</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar datos desde archivo SPSS</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="fu">here</span>(<span class="st">"datos"</span>, <span class="st">"BBDD Consolidada Maule UCM Codificada 20220307.sav"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creación-del-indicador-de-clase-social" class="level2">
<h2 class="anchored" data-anchor-id="creación-del-indicador-de-clase-social">Creación del Indicador de Clase Social</h2>
<p>Creamos un indicador de clase social basado en prestigio ocupacional. Este indicador será utilizado posteriormente como una covariable en nuestros modelos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diccionario de puntajes de prestigio ocupacional</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>puntajes_prestigio <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>categoria, <span class="sc">~</span>descripcion, <span class="sc">~</span>puntaje_prestigio,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">"Trabajadores no calificados en ventas y servicios, peones agropecuarios, forestales, construcción, etc."</span>, <span class="fl">25.0</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">"Obreros, operarios y artesanos de artes mecánicas y de otros oficios"</span>, <span class="fl">35.0</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">"Trabajadores de los servicios y vendedores de comercio y mercados"</span>, <span class="fl">37.0</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">4</span>, <span class="st">"Agricultores y trabajadores calificados agropecuarios y pesqueros"</span>, <span class="fl">42.0</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5</span>, <span class="st">"Operadores de instalaciones y máquinas y montadores / conductores de vehículos"</span>, <span class="fl">40.0</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>, <span class="st">"Empleados de oficina públicos y privados"</span>, <span class="fl">47.0</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">7</span>, <span class="st">"Técnicos y profesionales de nivel medio (incluye hasta suboficiales FFAA y Carabineros)"</span>, <span class="fl">58.0</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">8</span>, <span class="st">"Profesionales, científicos e intelectuales"</span>, <span class="fl">72.0</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">9</span>, <span class="st">"Alto ejecutivo (gerente general o gerente de área o sector) de empresa privadas o públicas"</span>, <span class="fl">78.0</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>, <span class="st">"Otros grupos no identificados (incluye rentistas, incapacitados, estudiantes, dueña de casa, etc.)"</span>, <span class="fl">40.0</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para asignar puntajes de prestigio según la categoría ocupacional</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>asignar_prestigio <span class="ot">&lt;-</span> <span class="cf">function</span>(categoria) {</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(categoria)) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  prestigio <span class="ot">&lt;-</span> puntajes_prestigio<span class="sc">$</span>puntaje_prestigio[puntajes_prestigio<span class="sc">$</span>categoria <span class="sc">==</span> categoria]</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(prestigio) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(prestigio)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar la función a las variables ocupacionales</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertir categorías ocupacionales a puntajes de prestigio</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">prestigio_M9A =</span> <span class="fu">sapply</span>(M9A, asignar_prestigio),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">prestigio_M9B =</span> <span class="fu">sapply</span>(M9B, asignar_prestigio),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tomar el máximo puntaje de prestigio entre el entrevistado y el sostenedor</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">nivel_ocup_prestigio =</span> <span class="fu">pmax</span>(prestigio_M9A, prestigio_M9B, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear indicador de clase social con componentes multidimensionales</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>datos_clase <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Educación (mayor nivel entre el entrevistado y el sostenedor)</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">nivel_educ =</span> <span class="fu">pmax</span>(M61, M62, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Ocupación (mayor prestigio ocupacional entre entrevistado y sostenedor)</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">nivel_ocup =</span> nivel_ocup_prestigio,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Índice de posesiones (normalizado)</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">indice_posesiones =</span> (</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale</span>(M13_1) <span class="sc">+</span>  <span class="co"># Autos</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale</span>(M13_2) <span class="sc">+</span>  <span class="co"># Baños</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale</span>(M13_3) <span class="sc">+</span>  <span class="co"># Metros cuadrados construidos</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale</span>(M13_5) <span class="sc">+</span>  <span class="co"># Televisores</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale</span>(M13_6)    <span class="co"># Libros</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">/</span> <span class="dv">5</span>,  <span class="co"># Promedio para dar igual peso</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Gastos mensuales (normalizado)</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">indice_gastos =</span> (</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale</span>(M16_1) <span class="sc">+</span>  <span class="co"># Agua</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale</span>(M16_2) <span class="sc">+</span>  <span class="co"># Electricidad</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale</span>(M16_3) <span class="sc">+</span>  <span class="co"># Combustible</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale</span>(M16_4)    <span class="co"># Calefacción</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">/</span> <span class="dv">4</span>  <span class="co"># Promedio para dar igual peso</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalizar componentes y crear índice ponderado</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>datos_clase <span class="ot">&lt;-</span> datos_clase <span class="sc">%&gt;%</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">nivel_educ_norm =</span> <span class="fu">scale</span>(nivel_educ),</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">nivel_ocup_norm =</span> <span class="fu">scale</span>(nivel_ocup),</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Índice compuesto con ponderación: Educación (40%), Ocupación (35%), Posesiones (20%), Gastos (5%)</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">indice_clase_social =</span> (</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>      nivel_educ_norm <span class="sc">*</span> <span class="fl">0.40</span> <span class="sc">+</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        nivel_ocup_norm <span class="sc">*</span> <span class="fl">0.35</span> <span class="sc">+</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        indice_posesiones <span class="sc">*</span> <span class="fl">0.20</span> <span class="sc">+</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        indice_gastos <span class="sc">*</span> <span class="fl">0.05</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categorización en clases sociales usando percentiles específicos</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">clase_social_cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>      indice_clase_social <span class="sc">&lt;</span> <span class="fu">quantile</span>(indice_clase_social, <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Baja"</span>,</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>      indice_clase_social <span class="sc">&gt;=</span> <span class="fu">quantile</span>(indice_clase_social, <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> </span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>        indice_clase_social <span class="sc">&lt;</span> <span class="fu">quantile</span>(indice_clase_social, <span class="fl">0.60</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Media-baja"</span>,</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>      indice_clase_social <span class="sc">&gt;=</span> <span class="fu">quantile</span>(indice_clase_social, <span class="fl">0.60</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> </span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        indice_clase_social <span class="sc">&lt;</span> <span class="fu">quantile</span>(indice_clase_social, <span class="fl">0.85</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Media"</span>,</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>      indice_clase_social <span class="sc">&gt;=</span> <span class="fu">quantile</span>(indice_clase_social, <span class="fl">0.85</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> </span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        indice_clase_social <span class="sc">&lt;</span> <span class="fu">quantile</span>(indice_clase_social, <span class="fl">0.95</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Media-alta"</span>,</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>      indice_clase_social <span class="sc">&gt;=</span> <span class="fu">quantile</span>(indice_clase_social, <span class="fl">0.95</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Alta"</span>,</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertir a factor con niveles ordenados</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">clase_social_cat =</span> <span class="fu">factor</span>(clase_social_cat, </span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Baja"</span>, <span class="st">"Media-baja"</span>, <span class="st">"Media"</span>, <span class="st">"Media-alta"</span>, <span class="st">"Alta"</span>))</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar distribución de clases sociales</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>distribucion <span class="ot">&lt;-</span> <span class="fu">table</span>(datos_clase<span class="sc">$</span>clase_social_cat, <span class="at">useNA =</span> <span class="st">"ifany"</span>)</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>porcentajes <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(distribucion) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">data.frame</span>(</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">Clase =</span> <span class="fu">names</span>(distribucion),</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">Frecuencia =</span> <span class="fu">as.vector</span>(distribucion),</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">Porcentaje =</span> <span class="fu">round</span>(<span class="fu">as.vector</span>(porcentajes), <span class="dv">1</span>)</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>), <span class="at">caption =</span> <span class="st">"Distribución de clases sociales"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Distribución de clases sociales</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Clase</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Frecuencia</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Porcentaje</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Baja</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Media-baja</td>
<td style="text-align: right;">700</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Media</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Media-alta</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alta</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="análisis-de-clases-latentes-lca" class="level1">
<h1>Análisis de Clases Latentes (LCA)</h1>
<section id="preparación-de-variables-para-el-modelo-lca" class="level2">
<h2 class="anchored" data-anchor-id="preparación-de-variables-para-el-modelo-lca">Preparación de variables para el modelo LCA</h2>
<p>Preparamos dos conjuntos de variables para el análisis de clases latentes:</p>
<ul>
<li><strong>Escala de Modo de Vida Imperial (MVI)</strong>: Refleja actitudes favorables a estilos de vida con altas emisiones de carbono</li>
<li><strong>Escala de Reflexividad Ambiental Antropocéntrica (RAA)</strong>: Refleja conciencia sobre problemas ambientales desde una perspectiva centrada en el ser humano</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Escala de Modo de Vida Imperial (MVI)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>vars_mvi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P7_2"</span>, <span class="st">"P7_4"</span>, <span class="st">"P7_5"</span>, <span class="st">"P4_2"</span>, <span class="st">"P4_4"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Escala de Reflexividad Ambiental Antropocéntrica (RAA)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>vars_raa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P7_1"</span>, <span class="st">"P7_3"</span>, <span class="st">"P4_1"</span>, <span class="st">"P4_3"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Recodificar P4_1 y P4_3 para mantener coherencia con las escalas</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">urgenciacrisis =</span> <span class="dv">5</span> <span class="sc">-</span> P4_1, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">actividadeshumanas =</span> <span class="dv">5</span> <span class="sc">-</span> P4_3</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables seleccionadas para el modelo</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>vars_modelo <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(P7_2, P7_4, P7_5, P4_2, P4_4, </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                P7_1, P7_3, urgenciacrisis, actividadeshumanas)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Dicotomizar las variables (1 = desacuerdo, 2 = acuerdo)</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>vars_modelo <span class="ot">&lt;-</span> vars_modelo <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="cn">NA</span>, <span class="fu">ifelse</span>(. <span class="sc">&gt;=</span> <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>))))</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparación de datos con covariables</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>datos_modelo <span class="ot">&lt;-</span> vars_modelo <span class="sc">%&gt;%</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Añadir clase social como covariable</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">clase_social =</span> datos_clase<span class="sc">$</span>clase_social_cat,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categorizar edad</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">edad =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>M5 <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> datos<span class="sc">$</span>M5 <span class="sc">&lt;=</span> <span class="dv">24</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>M5 <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> datos<span class="sc">$</span>M5 <span class="sc">&lt;=</span> <span class="dv">34</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>M5 <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> datos<span class="sc">$</span>M5 <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>M5 <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> datos<span class="sc">$</span>M5 <span class="sc">&lt;=</span> <span class="dv">54</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>M5 <span class="sc">&gt;=</span> <span class="dv">55</span> <span class="sc">&amp;</span> datos<span class="sc">$</span>M5 <span class="sc">&lt;=</span> <span class="dv">64</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>M5 <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">~</span> <span class="dv">6</span>,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">edad =</span> <span class="fu">factor</span>(edad, </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"18 a 24 años"</span>, <span class="st">"25 a 34 años"</span>, <span class="st">"35 a 44 años"</span>, </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"45 a 54 años"</span>, <span class="st">"55 a 64 años"</span>, <span class="st">"65 años o más"</span>)),</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sexo (M1)</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">sexo =</span> <span class="fu">factor</span>(datos<span class="sc">$</span>M1),</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Posición política (M11)</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">posicion_politica =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>M11 <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> datos<span class="sc">$</span>M11 <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Izquierda"</span>,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>M11 <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> datos<span class="sc">$</span>M11 <span class="sc">&lt;=</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Centro"</span>,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>M11 <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">&amp;</span> datos<span class="sc">$</span>M11 <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Derecha"</span>,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">posicion_politica =</span> <span class="fu">factor</span>(posicion_politica,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Izquierda"</span>, <span class="st">"Centro"</span>, <span class="st">"Derecha"</span>)),</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rural/Urbano (M12)</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">rural_urbano =</span> <span class="fu">factor</span>(datos<span class="sc">$</span>M12,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Urbano"</span>, <span class="st">"Rural"</span>, <span class="st">"Mixto"</span>))</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Fórmula con covariables para el modelo LCA</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>f_covariables <span class="ot">&lt;-</span> <span class="fu">cbind</span>(P7_2, P7_4, P7_5, P4_2, P4_4, </span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>                       P7_1, P7_3, urgenciacrisis, </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>                       actividadeshumanas) <span class="sc">~</span> sexo <span class="sc">+</span> edad <span class="sc">+</span> clase_social <span class="sc">+</span> posicion_politica <span class="sc">+</span> rural_urbano</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ajuste-de-modelos-de-clases-latentes" class="level2">
<h2 class="anchored" data-anchor-id="ajuste-de-modelos-de-clases-latentes">Ajuste de modelos de clases latentes</h2>
<p>Ajustamos modelos con diferente número de clases (de 2 a 4) para determinar la solución óptima:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Para reproducibilidad</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Lista para almacenar los modelos</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>modelos_cov <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>n_clases <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelos</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(n_clases)) {</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Ajustando modelo con"</span>, n_clases[i], <span class="st">"clases...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  modelos_cov[[i]] <span class="ot">&lt;-</span> <span class="fu">poLCA</span>(f_covariables, datos_modelo, </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">nclass =</span> n_clases[i], </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxiter =</span> <span class="dv">1000</span>, </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">nrep =</span> <span class="dv">5</span>, </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ajustando modelo con 2 clases...
Ajustando modelo con 3 clases...
Ajustando modelo con 4 clases...</code></pre>
</div>
</div>
</section>
<section id="comparación-de-modelos" class="level2">
<h2 class="anchored" data-anchor-id="comparación-de-modelos">Comparación de modelos</h2>
<p>Comparamos los modelos según criterios de información (BIC, AIC) y entropía para determinar el número óptimo de clases:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar cuáles modelos se ajustaron correctamente</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>modelos_validos <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">sapply</span>(modelos_cov, is.null)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear tabla de comparación solo con los modelos válidos</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">sum</span>(modelos_validos) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtener índices de modelos válidos</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  indices_validos <span class="ot">&lt;-</span> <span class="fu">which</span>(modelos_validos)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear vectores para almacenar resultados</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  clases <span class="ot">&lt;-</span> n_clases[indices_validos]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  log_likelihood <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(indices_validos))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  bic_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(indices_validos))</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  aic_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(indices_validos))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  entropia_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(indices_validos))</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer valores de cada modelo válido</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(indices_validos)) {</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> indices_validos[i]</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    modelo <span class="ot">&lt;-</span> modelos_cov[[idx]]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    log_likelihood[i] <span class="ot">&lt;-</span> modelo<span class="sc">$</span>llik</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    bic_values[i] <span class="ot">&lt;-</span> modelo<span class="sc">$</span>bic</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    aic_values[i] <span class="ot">&lt;-</span> modelo<span class="sc">$</span>aic</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    entropia_values[i] <span class="ot">&lt;-</span> <span class="fu">poLCA.entropy</span>(modelo)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear tabla de resultados</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  resultados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">Clases =</span> clases,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">Log_likelihood =</span> log_likelihood,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">BIC =</span> bic_values,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">AIC =</span> aic_values,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">Entropia =</span> entropia_values</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mostrar resultados</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(resultados, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">caption =</span> <span class="st">"Comparación de modelos LCA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualizar criterios de información</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(resultados) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Gráfico de BIC y AIC</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resultados, <span class="fu">aes</span>(<span class="at">x =</span> Clases)) <span class="sc">+</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> BIC, <span class="at">colour =</span> <span class="st">"BIC"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> BIC, <span class="at">colour =</span> <span class="st">"BIC"</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> AIC, <span class="at">colour =</span> <span class="st">"AIC"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> AIC, <span class="at">colour =</span> <span class="st">"AIC"</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Criterios de información por número de clases"</span>,</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Valor"</span>, </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">"Criterio"</span>) <span class="sc">+</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Gráfico de entropía</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(resultados, <span class="fu">aes</span>(<span class="at">x =</span> Clases, <span class="at">y =</span> Entropia)) <span class="sc">+</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Entropía por número de clases"</span>,</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Entropía"</span>) <span class="sc">+</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mostrar gráficos</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_reporte_completo_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<p>Basados en estos resultados, seleccionamos el modelo de 3 clases como la solución óptima, considerando el balance entre ajuste del modelo (AIC/BIC) y separación de clases (entropía).</p>
</section>
<section id="interpretación-del-modelo-de-3-clases" class="level2">
<h2 class="anchored" data-anchor-id="interpretación-del-modelo-de-3-clases">Interpretación del modelo de 3 clases</h2>
<p>Analizamos las probabilidades condicionales para interpretar el significado de cada clase latente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar el modelo de 3 clases (índice 2 porque empezamos con 2 clases)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>modelo_cov3 <span class="ot">&lt;-</span> modelos_cov[[<span class="dv">2</span>]]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer probabilidades condicionales</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>probs_clase_cov <span class="ot">&lt;-</span> modelo_cov3<span class="sc">$</span>probs</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir nombres de variables originales y etiquetas para el gráfico</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>var_originales <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P7_2"</span>, <span class="st">"P7_4"</span>, <span class="st">"P7_5"</span>, <span class="st">"P4_2"</span>, <span class="st">"P4_4"</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"P7_1"</span>, <span class="st">"P7_3"</span>, <span class="st">"urgenciacrisis"</span>, <span class="st">"actividadeshumanas"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>etiquetas <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"P7_2"</span> <span class="ot">=</span> <span class="st">"Problemas sociales &gt; ambientales (MVI)"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"P7_4"</span> <span class="ot">=</span> <span class="st">"Crecimiento sin daño ambiental (MVI)"</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"P7_5"</span> <span class="ot">=</span> <span class="st">"Problemas ambientales de países desarrollados (MVI)"</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"P4_2"</span> <span class="ot">=</span> <span class="st">"No cambiar costumbres, tecnología resolverá (MVI)"</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"P4_4"</span> <span class="ot">=</span> <span class="st">"Progreso es vivir como países desarrollados (MVI)"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"P7_1"</span> <span class="ot">=</span> <span class="st">"Resolver problemas cambiando costumbres (RAA)"</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"P7_3"</span> <span class="ot">=</span> <span class="st">"Clases altas más responsables de crisis (RAA)"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"urgenciacrisis"</span> <span class="ot">=</span> <span class="st">"Urgencia de la crisis ambiental (RAA)"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"actividadeshumanas"</span> <span class="ot">=</span> <span class="st">"Actividades humanas causan cambios climáticos (RAA)"</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar los datos para el gráfico</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>LMmodelo_cov <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Para cada variable y cada clase</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(probs_clase_cov)) {</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  var_nombre <span class="ot">&lt;-</span> var_originales[i]</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) { <span class="co"># Para las 3 clases</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    temp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">item =</span> var_nombre,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">state =</span> j,</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">category =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),  <span class="co"># 0 = Desacuerdo, 1 = Acuerdo</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">value =</span> <span class="fu">c</span>(probs_clase_cov[[i]][j, <span class="dv">1</span>], probs_clase_cov[[i]][j, <span class="dv">2</span>])</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    LMmodelo_cov <span class="ot">&lt;-</span> <span class="fu">rbind</span>(LMmodelo_cov, temp_df)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener porcentajes de las clases</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>porcentajes_cov <span class="ot">&lt;-</span> <span class="fu">round</span>(modelo_cov3<span class="sc">$</span>P <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">0</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Formatear los datos </span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>LMmodelo_cov <span class="ot">&lt;-</span> LMmodelo_cov <span class="sc">%&gt;%</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">clase =</span> <span class="fu">factor</span>(<span class="fu">paste0</span>(<span class="st">"Clase "</span>, state, <span class="st">" ("</span>, porcentajes_cov[state], <span class="st">"%)"</span>),</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">paste0</span>(<span class="st">"Clase "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">" ("</span>, porcentajes_cov[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="st">"%)"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(category <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Desacuerdo"</span>, <span class="st">"Acuerdo"</span>),</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Desacuerdo"</span>, <span class="st">"Acuerdo"</span>)))</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico horizontal con barras apiladas</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(LMmodelo_cov, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(item, <span class="at">levels =</span> var_originales, <span class="at">labels =</span> etiquetas[var_originales]), </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>                         <span class="at">x =</span> value, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> clase) <span class="sc">+</span>  <span class="co"># Clases en columnas</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Desacuerdo"</span> <span class="ot">=</span> <span class="st">"#A8D8E8"</span>, <span class="st">"Acuerdo"</span> <span class="ot">=</span> <span class="st">"#000000"</span>)) <span class="sc">+</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Probabilidades condicionales por clase latente"</span>,</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Modelo con 3 clases y covariables"</span>,</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Probabilidad"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Respuesta"</span>) <span class="sc">+</span> </span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>()</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_reporte_completo_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<section id="descripción-de-las-clases-latentes" class="level3">
<h3 class="anchored" data-anchor-id="descripción-de-las-clases-latentes">Descripción de las clases latentes</h3>
<p>Basándonos en el análisis de las probabilidades condicionales, interpretamos cada clase:</p>
<ul>
<li><p>Clase 1 (60%, Ambientalismo Moderado): Esta clase se caracteriza por un perfil mixto con alto desacuerdo en reconocer la crisis ambiental y sus causas humanas, pero moderado acuerdo con la necesidad de cambiar costumbres. Muestra alto desacuerdo con afirmaciones sobre la urgencia de la crisis ambiental y la influencia de actividades humanas en el cambio climático, junto con un acuerdo moderado en que el crecimiento es posible sin daño ambiental. Es la clase más numerosa.</p></li>
<li><p>Clase 2 (13%, Modo de Vida Imperial): Presenta un perfil interesante con reconocimiento de la crisis ambiental pero menor disposición al cambio. Muestra acuerdo moderado en que las actividades humanas causan cambios climáticos y sobre la urgencia de la crisis ambiental, pero también apoya ideas de que el crecimiento es posible sin daño ambiental. Demuestra menor acuerdo con la necesidad de cambiar costumbres y estilos de vida para resolver problemas ambientales.</p></li>
<li><p>Clase 3 (27%, Ambientalismo Crítico): Muestra un perfil contradictorio con posiciones fuertes en ambas escalas (MVI y RAA). Presenta muy alto desacuerdo con reconocer la urgencia de la crisis ambiental y la influencia humana, pero simultáneamente muestra alto acuerdo con que las clases altas son más responsables de la crisis y con la necesidad de resolver problemas cambiando costumbres. También muestra fuerte acuerdo con ideas del modo de vida imperial como que la tecnología resolverá los problemas sin cambiar costumbres, que el progreso es vivir como países desarrollados, y que el crecimiento es posible sin daño ambiental.</p></li>
</ul>
</section>
</section>
<section id="asignación-de-clases-a-individuos" class="level2">
<h2 class="anchored" data-anchor-id="asignación-de-clases-a-individuos">Asignación de clases a individuos</h2>
<p>Asignamos a cada individuo la clase latente con mayor probabilidad posterior:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Integrar la variable de clase en el dataframe original</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Primero, obtener las probabilidades posteriores de pertenencia a cada clase</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>posterior_probs <span class="ot">&lt;-</span> modelo_cov3<span class="sc">$</span>posterior</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar cada observación a la clase con mayor probabilidad posterior</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>clase_asignada <span class="ot">&lt;-</span> <span class="fu">apply</span>(posterior_probs, <span class="dv">1</span>, which.max)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir la clase asignada al dataframe original</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clase_latente =</span> <span class="cn">NA</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Solo asignar clases a las observaciones que se usaron en el modelo</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># (aquellas sin valores faltantes en las variables del modelo)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>indices_validos <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(datos_modelo[, var_originales]))))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>datos<span class="sc">$</span>clase_latente[indices_validos] <span class="ot">&lt;-</span> clase_asignada</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir a factor con etiquetas descriptivas</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clase_latente_factor =</span> <span class="fu">factor</span>(clase_latente,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">"Clase "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">" ("</span>, porcentajes_cov, <span class="st">"%)"</span>)))</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar distribución de clases</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(datos<span class="sc">$</span>clase_latente, <span class="at">useNA =</span> <span class="st">"ifany"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   1    2    3 
1277  214  509 </code></pre>
</div>
</div>
</section>
<section id="efecto-de-las-covariables-en-la-pertenencia-a-clases" class="level2">
<h2 class="anchored" data-anchor-id="efecto-de-las-covariables-en-la-pertenencia-a-clases">Efecto de las covariables en la pertenencia a clases</h2>
<p>Examinamos cómo las covariables sociodemográficas influyen en la probabilidad de pertenecer a cada clase:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define el número de clases y el índice del modelo</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>clases_deseadas <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>indice_problematico <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionar el objeto del modelo final</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>modelo_final_seleccionado <span class="ot">&lt;-</span> modelos_cov[[indice_problematico]]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer coeficientes y errores estándar</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>coeficientes <span class="ot">&lt;-</span> modelo_final_seleccionado<span class="sc">$</span>coeff</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>errores_est <span class="ot">&lt;-</span> modelo_final_seleccionado<span class="sc">$</span>coeff.se</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombres de las clases para las comparaciones</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>n_comparaciones <span class="ot">&lt;-</span> clases_deseadas <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>nombres_comparacion <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Log-Odds(Clase"</span>, <span class="dv">2</span><span class="sc">:</span>clases_deseadas, <span class="st">"/ Clase 1)"</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignar nombres de columna</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coeficientes) <span class="ot">&lt;-</span> nombres_comparacion</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(errores_est) <span class="ot">&lt;-</span> nombres_comparacion</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir matrices a dataframes </span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>df_coef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(coeficientes) <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"Variable"</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>df_se <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(errores_est) <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"Variable"</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Unir coeficientes y errores estándar y calcular intervalos de confianza (95%)</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>z_critico <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> df_coef <span class="sc">%&gt;%</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Variable, <span class="at">names_to =</span> <span class="st">"Comparacion"</span>, <span class="at">values_to =</span> <span class="st">"Estimado"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    df_se <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Variable, <span class="at">names_to =</span> <span class="st">"Comparacion"</span>, <span class="at">values_to =</span> <span class="st">"SE"</span>),</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"Comparacion"</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SE) <span class="sc">&amp;</span> <span class="fu">is.finite</span>(SE) <span class="sc">&amp;</span> SE <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># Filtra SEs inválidos</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">CI_lower =</span> Estimado <span class="sc">-</span> z_critico <span class="sc">*</span> SE,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">CI_upper =</span> Estimado <span class="sc">+</span> z_critico <span class="sc">*</span> SE,</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Comparacion =</span> <span class="fu">factor</span>(Comparacion, <span class="at">levels =</span> nombres_comparacion),</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> <span class="fu">fct_rev</span>(<span class="fu">factor</span>(Variable)) <span class="co"># Reordenar eje Y</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el gráfico de coeficientes</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> Estimado, <span class="at">y =</span> Variable)) <span class="sc">+</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> CI_lower, <span class="at">xmax =</span> CI_upper), <span class="at">height =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Comparacion), <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Comparacion, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">ncol =</span> n_comparaciones) <span class="sc">+</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Efecto de covariables en la pertenencia a clases latentes"</span>,</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Coeficientes vs Clase 1 (IC 95%)"</span>,</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Estimado del Coeficiente (Log-Odds relativo a Clase 1)"</span>,</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Covariable / Nivel"</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"lines"</span>)</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_reporte_completo_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="análisis-de-patrones-de-movilidad" class="level1">
<h1>Análisis de Patrones de Movilidad</h1>
<section id="recodificación-de-variables-de-movilidad" class="level2">
<h2 class="anchored" data-anchor-id="recodificación-de-variables-de-movilidad">Recodificación de variables de movilidad</h2>
<p>Recodificamos las variables de movilidad para el análisis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir etiquetas para las nuevas categorías</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>labels_recod5 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"A pie"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"En bicicleta"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Moto/Scooter"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Auto/Camioneta"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"Bus/Micro/Colectivo"</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>labels_recod4 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Activa (Pie/Bici)"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Moto/Scooter"</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Auto/Camioneta"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Bus/Micro/Colectivo"</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recodificación 5 categorías para O3_1 (Presente)</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_presente_recod5 =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>      O3_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># A pie</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>      O3_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">2</span>, <span class="co"># En bicicleta</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>      O3_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>) <span class="sc">~</span> <span class="dv">3</span>, <span class="co"># En moto, En moto eléctrica / Scooter eléctrico</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>      O3_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="dv">4</span>, <span class="co"># En un automóvil, En camioneta, En auto</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>      O3_1 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">5</span>, <span class="co"># En bus interurbano / micro / colectivo</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span> <span class="co"># Maneja NAs u otros valores no esperados</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recodificación 5 categorías para O4_1 (Futuro)</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_futura_recod5 =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>      O4_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>      O4_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>      O4_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>) <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>      O4_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>      O4_1 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Opcional: Recodificación 4 categorías para O3_1 (Presente)</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_presente_recod4 =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>      O3_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># A pie, En bicicleta -&gt; Activa</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>      O3_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>) <span class="sc">~</span> <span class="dv">2</span>, <span class="co"># Moto/Scooter</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>      O3_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="dv">3</span>, <span class="co"># Auto/Camioneta</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>      O3_1 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">4</span>, <span class="co"># Bus/Micro/Colectivo</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Opcional: Recodificación 4 categorías para O4_1 (Futuro)</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_futura_recod4 =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>      O4_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>      O4_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>) <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>      O4_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>      O4_1 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convertir las nuevas variables a factores con etiquetas</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_presente_recod5 =</span> <span class="fu">factor</span>(movilidad_presente_recod5, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">labels =</span> labels_recod5),</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_futura_recod5 =</span> <span class="fu">factor</span>(movilidad_futura_recod5, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">labels =</span> labels_recod5),</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_presente_recod4 =</span> <span class="fu">factor</span>(movilidad_presente_recod4, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">labels =</span> labels_recod4),</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_futura_recod4 =</span> <span class="fu">factor</span>(movilidad_futura_recod4, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">labels =</span> labels_recod4)</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="análisis-bivariado-clases-latentes-y-movilidad-presente" class="level2">
<h2 class="anchored" data-anchor-id="análisis-bivariado-clases-latentes-y-movilidad-presente">Análisis bivariado: Clases latentes y movilidad presente</h2>
<p>Analizamos la relación entre las clases latentes identificadas y los patrones de movilidad presente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabla cruzada (Frecuencias)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tabla_pres_freq <span class="ot">&lt;-</span> <span class="fu">table</span>(datos<span class="sc">$</span>clase_latente_factor, datos<span class="sc">$</span>movilidad_presente_recod5, <span class="at">useNA =</span> <span class="st">"ifany"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabla cruzada (Porcentajes por fila - por clase latente)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>tabla_pres_prop <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(tabla_pres_freq[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">margin =</span> <span class="dv">1</span>) <span class="co"># Excluye NA de prop.table</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar tabla formateada</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">round</span>(tabla_pres_prop <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Modo de movilidad presente (%) por clase latente"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Modo de movilidad presente (%) por clase latente</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">A pie</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">En bicicleta</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Moto/Scooter</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Auto/Camioneta</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bus/Micro/Colectivo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Clase 1 (60%)</td>
<td style="text-align: right;">16.3</td>
<td style="text-align: right;">10.3</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">50.0</td>
<td style="text-align: right;">22.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clase 2 (13%)</td>
<td style="text-align: right;">17.8</td>
<td style="text-align: right;">10.7</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">46.7</td>
<td style="text-align: right;">24.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clase 3 (27%)</td>
<td style="text-align: right;">14.3</td>
<td style="text-align: right;">13.9</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">50.7</td>
<td style="text-align: right;">19.6</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prueba Chi-cuadrado</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Usamos la tabla de frecuencias sin la columna NA si existe</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>tabla_chi_pres <span class="ot">&lt;-</span> tabla_pres_freq[, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(tabla_pres_freq) <span class="sc">-</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(<span class="fu">colnames</span>(tabla_pres_freq))))]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>chi_test_pres <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(tabla_chi_pres)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chi_test_pres)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  tabla_chi_pres
X-squared = 10.974, df = 8, p-value = 0.2032</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico (Barras apiladas por porcentaje)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>plot_data_pres <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(clase_latente_factor) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(movilidad_presente_recod5)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(clase_latente_factor, movilidad_presente_recod5) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clase_latente_factor) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data_pres, <span class="fu">aes</span>(<span class="at">x =</span> clase_latente_factor, <span class="at">y =</span> prop, <span class="at">fill =</span> movilidad_presente_recod5)) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(prop, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_fill</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="co"># Añadir etiquetas de %</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>, <span class="at">name =</span> <span class="st">"Modo Presente"</span>) <span class="sc">+</span> <span class="co"># Elige una paleta de colores</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribución del modo de movilidad presente por clase latente"</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Recodificado en 5 categorías"</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Clase Latente"</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Porcentaje dentro de cada clase latente"</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="co"># Mejorar legibilidad de etiquetas x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_reporte_completo_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="análisis-bivariado-clases-latentes-y-movilidad-futura" class="level2">
<h2 class="anchored" data-anchor-id="análisis-bivariado-clases-latentes-y-movilidad-futura">Análisis bivariado: Clases latentes y movilidad futura</h2>
<p>Ahora analizamos la relación con las preferencias de movilidad futura:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabla cruzada (Frecuencias)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>tabla_fut_freq <span class="ot">&lt;-</span> <span class="fu">table</span>(datos<span class="sc">$</span>clase_latente_factor, datos<span class="sc">$</span>movilidad_futura_recod5, <span class="at">useNA =</span> <span class="st">"ifany"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabla cruzada (Porcentajes por fila - por clase latente)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>tabla_fut_prop <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(tabla_fut_freq[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">margin =</span> <span class="dv">1</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar tabla formateada</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">round</span>(tabla_fut_prop <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Modo de movilidad futuro preferido (%) por clase latente"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="st">"striped"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Modo de movilidad futuro preferido (%) por clase latente</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">A pie</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">En bicicleta</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Moto/Scooter</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Auto/Camioneta</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Bus/Micro/Colectivo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Clase 1 (60%)</td>
<td style="text-align: right;">7.3</td>
<td style="text-align: right;">39.4</td>
<td style="text-align: right;">13.5</td>
<td style="text-align: right;">31.4</td>
<td style="text-align: right;">8.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clase 2 (13%)</td>
<td style="text-align: right;">6.1</td>
<td style="text-align: right;">36.9</td>
<td style="text-align: right;">13.6</td>
<td style="text-align: right;">36.9</td>
<td style="text-align: right;">6.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clase 3 (27%)</td>
<td style="text-align: right;">10.0</td>
<td style="text-align: right;">36.5</td>
<td style="text-align: right;">13.9</td>
<td style="text-align: right;">32.8</td>
<td style="text-align: right;">6.7</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prueba Chi-cuadrado</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tabla_chi_fut <span class="ot">&lt;-</span> tabla_fut_freq[, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(tabla_fut_freq) <span class="sc">-</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(<span class="fu">colnames</span>(tabla_fut_freq))))]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>chi_test_fut <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(tabla_chi_fut)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chi_test_fut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  tabla_chi_fut
X-squared = 9.1303, df = 8, p-value = 0.3314</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico (Barras apiladas por porcentaje)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plot_data_fut <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(clase_latente_factor) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(movilidad_futura_recod5)) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(clase_latente_factor, movilidad_futura_recod5) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clase_latente_factor) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data_fut, <span class="fu">aes</span>(<span class="at">x =</span> clase_latente_factor, <span class="at">y =</span> prop, <span class="at">fill =</span> movilidad_futura_recod5)) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(prop, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_fill</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>, <span class="at">name =</span> <span class="st">"Modo Futuro"</span>) <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribución del modo de movilidad futuro preferido por clase latente"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Recodificado en 5 categorías"</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Clase Latente"</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Porcentaje dentro de cada clase latente"</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_reporte_completo_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="modelos-multinomiales" class="level1">
<h1>Modelos Multinomiales</h1>
<section id="preparación-de-datos-para-los-modelos" class="level2">
<h2 class="anchored" data-anchor-id="preparación-de-datos-para-los-modelos">Preparación de datos para los modelos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir clase latente y movilidad a datos_modelo</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>datos_modelo <span class="ot">&lt;-</span> datos_modelo <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Añadir clase latente desde 'datos'</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">clase_latente_factor =</span> <span class="fu">as.factor</span>(datos<span class="sc">$</span>clase_latente_factor),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recodificar movilidad presente y futura</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_presente_recod5 =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O3_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O3_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">2</span>, </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O3_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>) <span class="sc">~</span> <span class="dv">3</span>, </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O3_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="dv">4</span>, </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O3_1 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">5</span>, </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">labels =</span> labels_recod5),</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">movilidad_futura_recod5 =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O4_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O4_1 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">2</span>, </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O4_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>) <span class="sc">~</span> <span class="dv">3</span>, </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O4_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>) <span class="sc">~</span> <span class="dv">4</span>, </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>      datos<span class="sc">$</span>O4_1 <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">5</span>, </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">labels =</span> labels_recod5),</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Asegurar que las covariables sean factores</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">"edad"</span>, <span class="st">"sexo"</span>, <span class="st">"clase_social"</span>, <span class="st">"rural_urbano"</span>), as.factor)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir controles sociodemográficos</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>sociodem_vars_en_modelo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"edad"</span>, <span class="st">"sexo"</span>, <span class="st">"clase_social"</span>, <span class="st">"rural_urbano"</span>)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Establecer referencias</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Clase latente</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>ref_clase_latente <span class="ot">&lt;-</span> <span class="fu">levels</span>(datos_modelo<span class="sc">$</span>clase_latente_factor)[<span class="dv">1</span>]</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>datos_modelo<span class="sc">$</span>clase_latente_factor <span class="ot">&lt;-</span> <span class="fu">relevel</span>(datos_modelo<span class="sc">$</span>clase_latente_factor, <span class="at">ref =</span> ref_clase_latente)</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Referencias para controles sociodemográficos</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>datos_modelo<span class="sc">$</span>sexo <span class="ot">&lt;-</span> <span class="fu">relevel</span>(datos_modelo<span class="sc">$</span>sexo, <span class="at">ref =</span> <span class="st">"1"</span>) <span class="co"># Asume 1=Hombre</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>datos_modelo<span class="sc">$</span>edad <span class="ot">&lt;-</span> <span class="fu">relevel</span>(datos_modelo<span class="sc">$</span>edad, <span class="at">ref =</span> <span class="st">"18 a 24 años"</span>)</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>datos_modelo<span class="sc">$</span>clase_social <span class="ot">&lt;-</span> <span class="fu">relevel</span>(datos_modelo<span class="sc">$</span>clase_social, <span class="at">ref =</span> <span class="st">"Baja"</span>)</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>datos_modelo<span class="sc">$</span>rural_urbano <span class="ot">&lt;-</span> <span class="fu">relevel</span>(datos_modelo<span class="sc">$</span>rural_urbano, <span class="at">ref =</span> <span class="st">"Urbano"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelo-para-movilidad-presente" class="level2">
<h2 class="anchored" data-anchor-id="modelo-para-movilidad-presente">Modelo para movilidad presente</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir las variables necesarias para el modelo</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>vd_presente <span class="ot">&lt;-</span> <span class="st">"movilidad_presente_recod5"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>datos_modelo[[vd_presente]] <span class="ot">&lt;-</span> <span class="fu">relevel</span>(datos_modelo[[vd_presente]], <span class="at">ref =</span> <span class="st">"Bus/Micro/Colectivo"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir los nombres de las variables a usar</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>variables_necesarias <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"movilidad_presente_recod5"</span>, <span class="st">"clase_latente_factor"</span>, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"sexo"</span>, <span class="st">"edad"</span>, <span class="st">"clase_social"</span>, <span class="st">"rural_urbano"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un dataframe con solo las variables necesarias usando sintaxis base R</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>datos_completos_pres <span class="ot">&lt;-</span> datos_modelo[, variables_necesarias]</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminar filas con NA usando sintaxis base R</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>datos_completos_pres <span class="ot">&lt;-</span> datos_completos_pres[<span class="fu">complete.cases</span>(datos_completos_pres), ]</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular número de datos completos y perdidos</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>n_completo_pres <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datos_completos_pres)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>n_perdido_pres <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datos_modelo) <span class="sc">-</span> n_completo_pres</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo multinomial (solo si hay datos suficientes)</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (n_completo_pres <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Definir la fórmula</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  formula_multi_pres <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"movilidad_presente_recod5 ~ clase_latente_factor + sexo + edad + clase_social + rural_urbano"</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajustar el modelo</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  modelo_multi_pres <span class="ot">&lt;-</span> <span class="fu">multinom</span>(formula_multi_pres, <span class="at">data =</span> datos_completos_pres, </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>                                <span class="at">Hess =</span> <span class="cn">TRUE</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>, <span class="at">maxit =</span> <span class="dv">300</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer resultados con broom</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(broom)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  modelo_tidy <span class="ot">&lt;-</span> <span class="fu">tidy</span>(modelo_multi_pres)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir a RRR y añadir valor p</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular p-values</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>p.value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(modelo_tidy<span class="sc">$</span>statistic)))</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>RRR <span class="ot">&lt;-</span> <span class="fu">exp</span>(modelo_tidy<span class="sc">$</span>estimate)</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadir estrellas de significancia</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>stars <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>stars[modelo_tidy<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>] <span class="ot">&lt;-</span> <span class="st">"*"</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>stars[modelo_tidy<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.01</span>] <span class="ot">&lt;-</span> <span class="st">"**"</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>stars[modelo_tidy<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>] <span class="ot">&lt;-</span> <span class="st">"***"</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Formato de las estimaciones con 3 decimales y estrellas</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>RRR_format <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, modelo_tidy<span class="sc">$</span>RRR), modelo_tidy<span class="sc">$</span>stars)</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Agregar CI</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>CI_lower <span class="ot">&lt;-</span> <span class="fu">exp</span>(modelo_tidy<span class="sc">$</span>estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> modelo_tidy<span class="sc">$</span>std.error)</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>CI_upper <span class="ot">&lt;-</span> <span class="fu">exp</span>(modelo_tidy<span class="sc">$</span>estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> modelo_tidy<span class="sc">$</span>std.error)</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>  modelo_tidy<span class="sc">$</span>CI <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"["</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, modelo_tidy<span class="sc">$</span>CI_lower), <span class="st">", "</span>, </span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, modelo_tidy<span class="sc">$</span>CI_upper), <span class="st">"]"</span>)</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear tabla en formato académico</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Primero filtrar a los coeficientes de clase_latente_factor (los más importantes)</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>  clase_latente_efectos <span class="ot">&lt;-</span> modelo_tidy[<span class="fu">grep</span>(<span class="st">"clase_latente_factor"</span>, modelo_tidy<span class="sc">$</span>term), ]</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tabla 1: Efectos de clase latente</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>  academic_table1 <span class="ot">&lt;-</span> clase_latente_efectos <span class="sc">%&gt;%</span></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(y.level, term, RRR_format, CI, p.value) <span class="sc">%&gt;%</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Modo transporte"</span> <span class="ot">=</span> y.level,</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Variable"</span> <span class="ot">=</span> term,</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>      <span class="st">"RRR"</span> <span class="ot">=</span> RRR_format,</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>      <span class="st">"IC 95%"</span> <span class="ot">=</span> CI,</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Valor p"</span> <span class="ot">=</span> p.value</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tabla 2: Todos los coeficientes</span></span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear una tabla pivotada para que cada resultado (y.level) sea una columna</span></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>  academic_table2 <span class="ot">&lt;-</span> modelo_tidy <span class="sc">%&gt;%</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"clase_latente_factor"</span>, <span class="st">"Clase Latente: "</span>, term),</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"sexo"</span>, <span class="st">"Sexo: "</span>, term),</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"edad"</span>, <span class="st">"Edad: "</span>, term),</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"clase_social"</span>, <span class="st">"Clase social: "</span>, term),</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"rural_urbano"</span>, <span class="st">"Entorno: "</span>, term)</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(y.level, term, RRR_format) <span class="sc">%&gt;%</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_from =</span> y.level, </span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_from =</span> RRR_format</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"Variable"</span> <span class="ot">=</span> term)</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mostrar las tablas</span></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(academic_table1, </span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Efectos de la clase latente en la movilidad presente (Categoría de referencia: Bus/Micro/Colectivo)"</span>,</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">footnote</span>(<span class="at">symbol =</span> <span class="fu">c</span>(<span class="st">"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001"</span>))</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(academic_table2, </span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Relative Risk Ratios para todos los predictores - Movilidad Presente (Categoría de referencia: Bus/Micro/Colectivo)"</span>,</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="st">"lccccc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">footnote</span>(<span class="at">symbol =</span> <span class="fu">c</span>(<span class="st">"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001"</span>))</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Graficar efectos </span></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(effects<span class="sc">::</span><span class="fu">effect</span>(<span class="st">"clase_latente_factor"</span>, modelo_multi_pres), </span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>       <span class="at">multiline =</span> <span class="cn">TRUE</span>, </span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>       <span class="at">confint =</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"Probabilidad predicha de modo de transporte presente por clase latente"</span>)</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_reporte_completo_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>academic_table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  `Modo transporte` Variable                          RRR     `IC 95%` `Valor p`
  &lt;chr&gt;             &lt;chr&gt;                             &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;
1 A pie             clase_latente_factorClase 2 (13%) 0.967   [0.609,…    0.888 
2 A pie             clase_latente_factorClase 3 (27%) 1.014   [0.710,…    0.938 
3 En bicicleta      clase_latente_factorClase 2 (13%) 0.952   [0.550,…    0.861 
4 En bicicleta      clase_latente_factorClase 3 (27%) 1.580*  [1.079,…    0.0188
5 Moto/Scooter      clase_latente_factorClase 2 (13%) 0.000*… [0.000,…    0     
6 Moto/Scooter      clase_latente_factorClase 3 (27%) 1.168   [0.467,…    0.740 
7 Auto/Camioneta    clase_latente_factorClase 2 (13%) 0.823   [0.563,…    0.315 
8 Auto/Camioneta    clase_latente_factorClase 3 (27%) 1.157   [0.872,…    0.312 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>academic_table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 5
   Variable               `A pie` `En bicicleta` `Moto/Scooter` `Auto/Camioneta`
   &lt;chr&gt;                  &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;           
 1 (Intercept)            0.911   0.910          0.129**        1.279           
 2 Clase Latente: Clase … 0.967   0.952          0.000***       0.823           
 3 Clase Latente: Clase … 1.014   1.580*         1.168          1.157           
 4 Sexo: 2                0.356*… 0.257***       0.402*         0.312***        
 5 Edad: 25 a 34 años     1.350   1.328          1.140          2.135***        
 6 Edad: 35 a 44 años     1.158   0.963          1.842          2.569***        
 7 Edad: 45 a 54 años     1.135   0.495*         1.123          2.251***        
 8 Edad: 55 a 64 años     1.043   0.215***       0.376          1.573*          
 9 Edad: 65 años o más    0.926   0.371**        0.000          1.688*          
10 Clase social: Media-b… 0.894   0.775          0.650          1.159           
11 Clase social: Media    1.299   1.098          0.794          1.790**         
12 Clase social: Media-a… 1.813   0.868          1.273          3.193***        
13 Clase social: Alta     1.595   0.536          1.997          2.763**         
14 Entorno: Rural         0.764   1.174          1.047          1.352           
15 Entorno: Mixto         1.237   1.716**        0.862          1.259           </code></pre>
</div>
</div>
</section>
<section id="modelo-para-movilidad-futura" class="level2">
<h2 class="anchored" data-anchor-id="modelo-para-movilidad-futura">Modelo para movilidad futura</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir las variables necesarias para el modelo de movilidad futura</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>vd_futura <span class="ot">&lt;-</span> <span class="st">"movilidad_futura_recod5"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>datos_modelo[[vd_futura]] <span class="ot">&lt;-</span> <span class="fu">relevel</span>(datos_modelo[[vd_futura]], <span class="at">ref =</span> <span class="st">"Bus/Micro/Colectivo"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir los nombres de las variables a usar</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>variables_necesarias_fut <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"movilidad_futura_recod5"</span>, <span class="st">"clase_latente_factor"</span>, </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"sexo"</span>, <span class="st">"edad"</span>, <span class="st">"clase_social"</span>, <span class="st">"rural_urbano"</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un dataframe con solo las variables necesarias usando sintaxis base R</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>datos_completos_fut <span class="ot">&lt;-</span> datos_modelo[, variables_necesarias_fut]</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminar filas con NA usando sintaxis base R</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>datos_completos_fut <span class="ot">&lt;-</span> datos_completos_fut[<span class="fu">complete.cases</span>(datos_completos_fut), ]</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular número de datos completos y perdidos</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>n_completo_fut <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datos_completos_fut)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>n_perdido_fut <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datos_modelo) <span class="sc">-</span> n_completo_fut</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo multinomial (solo si hay datos suficientes)</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (n_completo_fut <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Definir la fórmula</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  formula_multi_fut <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"movilidad_futura_recod5 ~ clase_latente_factor + sexo + edad + clase_social + rural_urbano"</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ajustar el modelo</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  modelo_multi_fut <span class="ot">&lt;-</span> <span class="fu">multinom</span>(formula_multi_fut, <span class="at">data =</span> datos_completos_fut, </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>                               <span class="at">Hess =</span> <span class="cn">TRUE</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>, <span class="at">maxit =</span> <span class="dv">300</span>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extraer resultados con broom</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(broom)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut <span class="ot">&lt;-</span> <span class="fu">tidy</span>(modelo_multi_fut)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convertir a RRR y añadir valor p</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular p-values</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>p.value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(modelo_tidy_fut<span class="sc">$</span>statistic)))</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>RRR <span class="ot">&lt;-</span> <span class="fu">exp</span>(modelo_tidy_fut<span class="sc">$</span>estimate)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadir estrellas de significancia</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>stars <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>stars[modelo_tidy_fut<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>] <span class="ot">&lt;-</span> <span class="st">"*"</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>stars[modelo_tidy_fut<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.01</span>] <span class="ot">&lt;-</span> <span class="st">"**"</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>stars[modelo_tidy_fut<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>] <span class="ot">&lt;-</span> <span class="st">"***"</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Formato de las estimaciones con 3 decimales y estrellas</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>RRR_format <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, modelo_tidy_fut<span class="sc">$</span>RRR), modelo_tidy_fut<span class="sc">$</span>stars)</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Agregar CI</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>CI_lower <span class="ot">&lt;-</span> <span class="fu">exp</span>(modelo_tidy_fut<span class="sc">$</span>estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> modelo_tidy_fut<span class="sc">$</span>std.error)</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>CI_upper <span class="ot">&lt;-</span> <span class="fu">exp</span>(modelo_tidy_fut<span class="sc">$</span>estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> modelo_tidy_fut<span class="sc">$</span>std.error)</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>  modelo_tidy_fut<span class="sc">$</span>CI <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"["</span>, <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, modelo_tidy_fut<span class="sc">$</span>CI_lower), <span class="st">", "</span>, </span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, modelo_tidy_fut<span class="sc">$</span>CI_upper), <span class="st">"]"</span>)</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear tabla en formato académico</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Primero filtrar a los coeficientes de clase_latente_factor (los más importantes)</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>  clase_latente_efectos_fut <span class="ot">&lt;-</span> modelo_tidy_fut[<span class="fu">grep</span>(<span class="st">"clase_latente_factor"</span>, modelo_tidy_fut<span class="sc">$</span>term), ]</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tabla 1: Efectos de clase latente</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>  academic_table1_fut <span class="ot">&lt;-</span> clase_latente_efectos_fut <span class="sc">%&gt;%</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(y.level, term, RRR_format, CI, p.value) <span class="sc">%&gt;%</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Modo transporte"</span> <span class="ot">=</span> y.level,</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Variable"</span> <span class="ot">=</span> term,</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>      <span class="st">"RRR"</span> <span class="ot">=</span> RRR_format,</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>      <span class="st">"IC 95%"</span> <span class="ot">=</span> CI,</span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Valor p"</span> <span class="ot">=</span> p.value</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tabla 2: Todos los coeficientes</span></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear una tabla pivotada para que cada resultado (y.level) sea una columna</span></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>  academic_table2_fut <span class="ot">&lt;-</span> modelo_tidy_fut <span class="sc">%&gt;%</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"clase_latente_factor"</span>, <span class="st">"Clase Latente: "</span>, term),</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"sexo"</span>, <span class="st">"Sexo: "</span>, term),</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"edad"</span>, <span class="st">"Edad: "</span>, term),</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"clase_social"</span>, <span class="st">"Clase social: "</span>, term),</span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">sub</span>(<span class="st">"rural_urbano"</span>, <span class="st">"Entorno: "</span>, term)</span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(y.level, term, RRR_format) <span class="sc">%&gt;%</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_from =</span> y.level, </span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_from =</span> RRR_format</span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"Variable"</span> <span class="ot">=</span> term)</span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mostrar las tablas</span></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(academic_table1_fut, </span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Efectos de la clase latente en la movilidad futura (Categoría de referencia: Bus/Micro/Colectivo)"</span>,</span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">footnote</span>(<span class="at">symbol =</span> <span class="fu">c</span>(<span class="st">"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001"</span>))</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(academic_table2_fut, </span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Relative Risk Ratios para todos los predictores - Movilidad Futura (Categoría de referencia: Bus/Micro/Colectivo)"</span>,</span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">align =</span> <span class="st">"lccccc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">footnote</span>(<span class="at">symbol =</span> <span class="fu">c</span>(<span class="st">"* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001"</span>))</span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Graficar efectos </span></span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(effects<span class="sc">::</span><span class="fu">effect</span>(<span class="st">"clase_latente_factor"</span>, modelo_multi_fut), </span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a>       <span class="at">multiline =</span> <span class="cn">TRUE</span>, </span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>       <span class="at">confint =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"Probabilidad predicha de modo de transporte futuro por clase latente"</span>)</span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02_reporte_completo_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>academic_table1_fut</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  `Modo transporte` Variable                          RRR    `IC 95%`  `Valor p`
  &lt;chr&gt;             &lt;chr&gt;                             &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;
1 A pie             clase_latente_factorClase 2 (13%) 1.068  [0.474, …    0.873 
2 A pie             clase_latente_factorClase 3 (27%) 1.759* [1.045, …    0.0336
3 En bicicleta      clase_latente_factorClase 2 (13%) 1.247  [0.667, …    0.488 
4 En bicicleta      clase_latente_factorClase 3 (27%) 1.151  [0.746, …    0.525 
5 Moto/Scooter      clase_latente_factorClase 2 (13%) 1.327  [0.663, …    0.425 
6 Moto/Scooter      clase_latente_factorClase 3 (27%) 1.293  [0.798, …    0.297 
7 Auto/Camioneta    clase_latente_factorClase 2 (13%) 1.557  [0.840, …    0.160 
8 Auto/Camioneta    clase_latente_factorClase 3 (27%) 1.332  [0.864, …    0.195 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>academic_table2_fut</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 5
   Variable               `A pie` `En bicicleta` `Moto/Scooter` `Auto/Camioneta`
   &lt;chr&gt;                  &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;           
 1 (Intercept)            1.716   13.831***      3.147**        10.345***       
 2 Clase Latente: Clase … 1.068   1.247          1.327          1.557           
 3 Clase Latente: Clase … 1.759*  1.151          1.293          1.332           
 4 Sexo: 2                0.306*… 0.449***       0.419***       0.472***        
 5 Edad: 25 a 34 años     1.078   0.846          0.669          1.091           
 6 Edad: 35 a 44 años     1.404   0.723          0.595          1.044           
 7 Edad: 45 a 54 años     1.051   0.348**        0.379*         0.562           
 8 Edad: 55 a 64 años     0.845   0.199***       0.324**        0.376**         
 9 Edad: 65 años o más    0.748   0.077***       0.240***       0.351**         
10 Clase social: Media-b… 0.871   0.731          1.130          0.628           
11 Clase social: Media    0.811   1.144          1.729          0.637           
12 Clase social: Media-a… 0.793   0.618          1.139          0.526*          
13 Clase social: Alta     1.496   0.734          1.581          1.151           
14 Entorno: Rural         0.751   1.251          1.515          0.841           
15 Entorno: Mixto         0.934   1.825**        1.676*         1.343           </code></pre>
</div>
</div>
</section>
</section>
<section id="discusión-y-conclusiones" class="level1">
<h1>Discusión y Conclusiones</h1>
<p>El análisis revela tres clases latentes distintas en términos de actitudes ambientales, cada una con un perfil específico de creencias y valores:</p>
<ul>
<li><p>Ambientalismo Moderado (Clase 1, 60%): Constituye la mayoría de la muestra y se caracteriza por un perfil mixto, con alto desacuerdo en el reconocimiento de la crisis ambiental y sus causas humanas, pero moderado acuerdo con la necesidad de cambiar costumbres.</p></li>
<li><p>Modo de Vida Imperial (Clase 2, 13%): El grupo minoritario, presenta un reconocimiento moderado de la crisis ambiental pero menor disposición al cambio, con apoyo a la idea de que el crecimiento económico es posible sin daño ambiental.</p></li>
<li><p>Ambientalismo Crítico (Clase 3, 27%): Muestra un perfil aparentemente contradictorio, con posiciones fuertes en ambas escalas. Por un lado, manifiesta desacuerdo con reconocer la urgencia de la crisis ambiental, pero simultáneamente muestra alto acuerdo con la responsabilidad de las clases altas y la necesidad de cambiar costumbres.</p></li>
</ul>
<p>Los resultados de los modelos multinomiales muestran asociaciones específicas y puntuales entre estas clases latentes y los patrones de movilidad:</p>
<p>Los individuos de la clase “Ambientalismo Crítico” (Clase 3) muestran mayor probabilidad de usar bicicleta como medio de transporte presente (RRR: 1.579, p&lt;0.05) y mayor preferencia por caminar como modo de movilidad futura (RRR: 1.758, p&lt;0.05), comparados con la clase de referencia (Ambientalismo Moderado). Para la clase “Modo de Vida Imperial” (Clase 2) no se observan diferencias estadísticamente significativas en patrones de movilidad actual o preferencias futuras respecto a la clase de referencia.</p>
<p>Cabe destacar que los factores sociodemográficos muestran efectos más consistentes y estadísticamente significativos que la pertenencia a clases latentes:</p>
<ul>
<li><p>Sexo: Las mujeres presentan significativamente menor probabilidad de usar cualquier modo de transporte alternativo al transporte público (bus/micro/colectivo).</p></li>
<li><p>Edad: Personas de mayor edad muestran menor preferencia por movilidad activa, particularmente en bicicleta.</p></li>
<li><p>Clase social: Individuos de clases media, media-alta y alta tienen mayor probabilidad de usar automóvil como medio de transporte actual.</p></li>
<li><p>Entorno: Residentes de zonas mixtas muestran mayor preferencia por movilidad en bicicleta, tanto en patrones actuales como en preferencias futuras.</p></li>
</ul>
<p>Estos hallazgos sugieren que, aunque existe cierta relación entre las actitudes ambientales (representadas por las clases latentes) y algunos comportamientos específicos de movilidad, esta relación es más moderada y selectiva de lo esperado. Las intervenciones para promover movilidad sostenible deberían considerar primordialmente factores estructurales y sociodemográficos, complementando con estrategias que aborden las actitudes y valores ambientales de la población, especialmente en grupos específicos donde estas asociaciones resultan más significativas.</p>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{cantillan2025,
  author = {Cantillan, Roberto},
  title = {Análisis de {Clases} {Latentes} y {Patrones} de {Movilidad}},
  date = {2025},
  langid = {en},
  abstract = {Este documento presenta un análisis sociológico que
    identifica perfiles ambientales mediante modelos de clases latentes
    (LCA) y examina su relación con patrones de movilidad en la región
    del Maule, Chile. Utilizando datos de encuestas sobre actitudes
    ambientales, se identifican tres clases latentes: Ambientalismo
    Moderado (60\%), Modo de Vida Imperial (13\%) y Ambientalismo
    Crítico (27\%). Mediante modelos multinomiales, se analiza cómo
    estas clases predicen elecciones de transporte actual y preferencias
    futuras, controlando por factores sociodemográficos. Los resultados
    revelan asociaciones selectivas entre perfiles ambientales y
    movilidad, destacando que los factores estructurales ejercen mayor
    influencia que las actitudes en los comportamientos de movilidad
    cotidiana.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-cantillan2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Cantillan, Roberto. 2025. <span>“Análisis de Clases Latentes y Patrones
de Movilidad.”</span> <em>Documentos de Trabajo</em>.
</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>